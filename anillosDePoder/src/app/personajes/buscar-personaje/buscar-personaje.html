<div style="padding: 20px">
  <p-toast></p-toast>
  <p-confirmpopup></p-confirmpopup>

  <div
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px"
  >
    <h2>Lista de Personajes</h2>
    <p-button label="Nuevo Personaje" icon="pi pi-plus" routerLink="/personajes/nuevo"></p-button>
  </div>

  <p-table [value]="personajes" [tableStyle]="{ 'min-width': '50rem' }" stripedRows>
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="nombre">Nombre <p-sortIcon field="nombre"></p-sortIcon></th>
        <th pSortableColumn="raza">Raza <p-sortIcon field="raza"></p-sortIcon></th>
        <th>Nivel de Corrupción</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-personaje>
      <tr [ngClass]="{ 'opacity-50': personaje.fechaBaja }">
        <td>{{ personaje.nombre }}</td>
        <td>{{ personaje.raza }}</td>
        <td>
          <p-progressBar
            [value]="personaje.nivelCorrupcion"
            [showValue]="true"
            [style]="{ height: '20px' }"
          ></p-progressBar>
        </td>
        <td>
          @if (personaje.fechaBaja) {
            <span style="color: red; font-weight: bold"
              >Inactivo ({{ personaje.fechaBaja | date: 'shortDate' }})</span
            >
          } @else {
            <span style="color: green; font-weight: bold">Activo</span>
          }
        </td>
        <td>
          <div class="flex gap-2">
            <p-button
              icon="pi pi-pencil"
              [rounded]="true"
              severity="success"
              [routerLink]="['/personajes/editar', personaje.id]"
              pTooltip="Editar"
            ></p-button>

            @if (!personaje.fechaBaja) {
              <p-button
                icon="pi pi-ban"
                [rounded]="true"
                severity="warn"
                (onClick)="confirmarBajaLogica($event, personaje)"
                pTooltip="Baja Lógica"
              ></p-button>
            } @else {
              <p-button
                icon="pi pi-refresh"
                [rounded]="true"
                severity="info"
                (onClick)="confirmarBajaLogica($event, personaje)"
                pTooltip="Reactivar Personaje"
              ></p-button>
            }

            <p-button
              icon="pi pi-trash"
              [rounded]="true"
              severity="danger"
              (onClick)="confirmarBajaFisica($event, personaje.id)"
              pTooltip="Eliminar Físicamente"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" style="text-align: center">No hay personajes registrados.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
